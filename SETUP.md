# セットアップガイド

## 1. Google Apps Script プロジェクトの作成

### ステップ 1: 新しいプロジェクトを作成
1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「Gmail下書き管理」に変更

### ステップ 2: マニフェストファイルを有効にする
1. プロジェクト設定（歯車アイコン）をクリック
2. 「appsscript.json マニフェスト ファイルをエディタで表示する」をチェック

### ステップ 3: ファイルを追加・編集
1. **Code.gs**: デフォルトのコードを削除し、このプロジェクトの `Code.gs` の内容をコピー
2. **appsscript.json**: エディタに表示されたら、このプロジェクトの `appsscript.json` の内容で置き換え
3. **Helpers.gs**: 新しいファイルを追加し、このプロジェクトの `Helpers.gs` の内容をコピー

## 2. Google スプレッドシートの準備

### ステップ 1: 新しいスプレッドシートを作成
1. [Google Sheets](https://sheets.google.com/) にアクセス
2. 新しいスプレッドシートを作成
3. 分かりやすい名前を付ける（例：「Gmail下書き管理」）

### ステップ 2: スプレッドシート ID を取得
1. スプレッドシートの URL をコピー
2. URL の `d/` と `/edit` の間の文字列がスプレッドシート ID です
   ```
   https://docs.google.com/spreadsheets/d/[ここがスプレッドシートID]/edit#gid=0
   ```

### ステップ 3: Code.gs にスプレッドシート ID を設定
1. Google Apps Script エディタで `Code.gs` を開く
2. `YOUR_SPREADSHEET_ID_HERE` を実際のスプレッドシート ID に置き換え

## 3. 権限の設定と初回実行

### ステップ 1: 初回実行
1. Google Apps Script エディタで `main` 関数を選択
2. 「実行」ボタン（▶️）をクリック
3. 初回は権限の承認が必要です

### ステップ 2: 権限の承認
1. 「承認が必要です」ダイアログで「権限を確認」をクリック
2. Google アカウントを選択
3. 「詳細」→「Gmail下書き管理（安全ではないページ）に移動」をクリック
4. 「許可」をクリック

必要な権限：
- Gmail の閲覧権限
- Google Sheets の編集権限

## 4. 実行とテスト

### 基本的な実行
```javascript
main() // 下書きを取得してスプレッドシートに保存
```

### テスト関数
```javascript
checkDraftCount() // 現在の下書き数を確認
```

### 統計情報付きで実行
```javascript
saveWithStatistics('YOUR_SPREADSHEET_ID') // 統計情報も一緒に保存
```

## 5. 定期実行の設定（オプション）

### ステップ 1: トリガーの追加
1. Google Apps Script エディタ左側の「トリガー」をクリック
2. 「トリガーを追加」をクリック

### ステップ 2: トリガーの設定
- 実行する関数: `main`
- イベントのソース: `時間主導型`
- 時間ベースのトリガーのタイプ: お好みに応じて選択
  - 分ベースのタイマー: 毎時間
  - 時間ベースのタイマー: 毎日
  - 日ベースのタイマー: 毎週
  - 週ベースのタイマー: 毎月

## 6. トラブルシューティング

### よくある問題と解決方法

#### 「権限が不足しています」エラー
- 解決方法: 上記の権限承認手順を再度実行

#### 「スプレッドシートが見つかりません」エラー
- 解決方法: スプレッドシート ID が正しく設定されているか確認

#### 「実行時間の制限を超えました」エラー
- 解決方法: 下書きの数が多い場合は、`getDrafts()` 関数で取得件数を制限

#### 下書きが表示されない
- 確認事項: Gmail に実際に下書きが存在するか確認
- テスト: `checkDraftCount()` 関数で下書き数を確認

## 7. カスタマイズ

### フィルタリング機能の使用
```javascript
// 特定の条件で下書きをフィルタリング
const allDrafts = getDrafts();
const filteredDrafts = filterDrafts(allDrafts, {
  subjectContains: '重要',
  dateAfter: new Date('2024-01-01')
});
```

### 古い下書きの削除（注意して使用）
```javascript
// ドライラン（削除せずに対象を確認）
deleteOldDrafts(30, true);

// 実際に削除（30日より古い下書きを削除）
deleteOldDrafts(30, false);
```

## セキュリティについて

- このスクリプトは Gmail の読み取り専用権限を使用します
- 下書きの削除機能を使用する場合は十分注意してください
- スプレッドシートは適切な共有設定を行ってください
